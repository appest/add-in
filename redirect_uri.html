<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TickTick Addin</title>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>
  </head>
  <body>
    <script>
      function authenticationSuccess(data) {
        var arg;
        arg = {
          status: "auth success",
          token: data
        };
        Office.context.ui.messageParent(JSON.stringify(arg));
      }

      function authenticationFailure() {
        arg = {
          status: "auth failed",
          token: undefined
        };
        Office.context.ui.messageParent(JSON.stringify(arg));
      }

      function getParameterByName(name) {
        const hash = window.location.hash;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[#&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(hash);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

      // The Office initialize function must be run each time a new page is loaded.
      Office.initialize = function() {
        $(document).ready(function() {
          var token = getParameterByName("access_token");
          console.log(token);
          if (token) {
            authenticationSuccess(token);
          } else {
            authenticationFailure();
          }
        });
      };
    </script>
  </body>
</html>
