<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TickTick Addin</title>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>
  </head>
  <body>
    <!-- <form method="POST" id="form" action="https://ticktick.com/oauth/token" style="display: none;">
      <input type="text" name="client_id" id="id" />
      <input type="text" name="client_secret" id="secret" />
      <input type="text" name="code" id="code" />
      <input type="text" name="grant_type" id="type" />
      <input type="submit" name="client_id" id="submit" />
    </form> -->
    <script>
      function authenticationSuccess(data) {
        var arg;
        arg = {
          status: "auth success",
          token: data
        };
        Office.context.ui.messageParent(JSON.stringify(arg));
      }

      function authenticationFailure() {
        arg = {
          status: "auth failed",
          token: undefined
        };
        Office.context.ui.messageParent(JSON.stringify(arg));
      }

      function getParameterByName(name) {
        const url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

      // The Office initialize function must be run each time a new page is loaded.
      Office.initialize = function() {
        $(document).ready(function() {
          var token = getParameterByName("access_token");
          console.log(token);
          if (token) {
            authenticationSuccess(token);
          } else {
            authenticationFailure();
          }
          // var code = getParameterByName("code");
          // var url = window.location.toString();
          // var client_id = "29xVAE6nMzik67IBhN";
          // var client_secret = "%##rbgxh52C%8RGcdPTVAe_SqQY+Z^81";
          // var data = {
          //   client_id: client_id,
          //   client_secret: client_secret,
          //   code: code,
          //   grant_type: "authorization_code"
          // };
          // if (!code) {
          //   authenticationFailure();
          // }
          // $.ajax({
          //   type: "POST",
          //   url: "https://ticktick.com/oauth/token",
          //   data: data,
          //   xhrFields: {
          //     withCredentials: true
          //   },
          //   contentType: "application/x-www-form-urlencoded",
          //   headers: {
          //     "Access-Control-Allow-Origin": "*",
          //     "Access-Control-Allow-Methods": "GET,POST",
          //     "Access-Control-Allow-Headers": "x-requested-with"
          //   },
          //   success: authenticationSuccess,
          //   error: authenticationFailure
          // });
        });
      };
    </script>
  </body>
</html>
